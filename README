
                        python-netsnmpagent Module
         Copyright (c) 2013 Pieter Hollants <pieter@hollants.com>
           Licensed under the GNU Public License (GPL) version 3


WHAT IS IT?

python-netsnmpagent is a Python module that facilitates writing Net-SNMP
subagents in Python. Subagents connect to a locally running Master agent
(snmpd) over a Unix domain socket (eg. "/var/run/agentx/master") and using the
AgentX protocol (RFC2747). They implement custom Management Information Base
(MIB) modules that extend the local node's MIB tree. Usually, this requires
writing a MIB as well, ie. a text file that specifies the structure, names
and data types of the information within the MIB module.

python-netsnmpagent was written after a lot of frustration trying to fix the
python-agentx module hosted on Sourceforge. I fixed some smaller issues there
but when it came to making sure that you could actually walk the whole MIB, not
just the variables registered, I realized that it would not make much sense to
reimplement the complete behavior of a proper SNMP agent when the NetSNMP API
actually can handle those things for you. Also, to be honest, I don't get
python-agentx's design :-)

python-netsnmpagent, by contrast, in the first line focusses on making the
net-snmp C agent API accessible from Python. Though I will try not to just
pass through every library call 1:1 but wrap them in a useful manner.

net-snmp itself also comes with a Python module (see the "python" subdirectory
in the source distribution), however it seems to offer bindings that implement
the client side only, not the agent side.


REQUIREMENTS

python-netsnmpagent requires the net-snmp libraries to be installed. The
runtime libraries are enough, development files are not necessary.

Tested versions include 5.4.2 (included with SUSE Linux Enterprise Server 11
SP2), 5.4.3 (included with Ubuntu 12.04 LTS) and net-snmp 5.7.1 (included with
openSUSE 12.1). While the intent is to support both net-snmp 5.4.x and 5.7.x
versions at least for the near future, I want to avoid double code paths
whereever possible. I therefore have to stick to the net-snmp 5.4.x way of
things at certain places indicated by code comments.


DOWNLOAD

The PyPI page with distribution archives is available at

  http://pypi.python.org/pypi/netsnmpagent

Binary RPMs for SuSE distributions are available via search.opensuse.org and
the Open Build Service Project page at

  https://build.opensuse.org/package/show?package=python-netsnmpagent&project=home%3Apfhllnts

If you wish to follow development more closely clone the GitHub:

  https://github.com/pief/python-netsnmpagent.git


INSTALLATION

If you do not use a ready package for your Linux distribution, you can install
directly from source using

  python setup.py install

This will most probably require appropriate rights (eg. being "root").


EXAMPLE USAGE

python-netsnmpagent includes two example agents together with associated MIBs:
- examples/simple_agent.py is the first example you should look at. It
  demonstrates registering the various supported SNMP object types including
  tables. For those interested in SNMP v3 it also shows registering variables
  in contexts.
  The simple agent uses net-snmp's check_and_process() call to wait for SNMP
  requests in a blocking manner. Data is only updated inbetween SNMP requests.
  For a different, more real-life usable approach see the next example.
- examples/threading_agent.py should be looked at next. It registers just a
  single DisplayString SNMP variable but demonstrates how to use Python's
  threading module to separate the data update process from the SNMP request
  processing so that both can execute independently. 

For both examples, shell scripts are included that make it a waltz to play with
the agents. The scripts take care of everything required to set up a custom,
minimal snmpd instance that runs under your ordinary user account and separate
from any system-wide running snmpd. So just cd to the "examples/" directory
and try "run_simple_agent.sh" and "run_threading_agent.py".

If instead you want to run the example agents (or later on your own agents)
against your system-wide snmpd instance, your /etc/snmp/snmpd.conf (the path
may vary) must be configured appropriately. See the comments at the beginning
of examples/simple_agent.py for more info.


API

Admittedly the API for writing your own subagents in Python is not necessarily
stable yet. For now, please see the example agents' source code for info on
how to use the python-netsnmpagent module, but notice that this may change at
any time. You might want to follow development on the GitHub repo:

  https://github.com/pief/python-netsnmpagent.git


TODO

- notifications/traps
- stabilize API
- unit tests


CREDITS

python-netsnmpagent was inspired by python-agentx, courtesy of Bozhin Zafirov
<bozhin@abv.bg>. I blatantly ripped some ideas and some lines of code, shame
on me.

SNMP contexts support and various other additions were implemented by Steven
Hiscocks <steven@hiscocks.me.uk>.

The bug that DisplayStrings/OctetStrings got truncated when trying to update
them with a string larger that the original InitVal was hunted down and fixed
by Max "mk23" Kalika <max.kalika+projects@gmail.com>.
